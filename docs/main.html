<!DOCTYPE html>

<html>
<head>
  <title>Speed Maze</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Speed Maze</h1>
<h2>Corona SDK Game</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>In this game we&#39;ll have a tiny space invader who is trying to quickly
traverse a maze.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Gather some information about the current screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="keyword">local</span> screenWidth = display.contentWidth
<span class="keyword">local</span> screenHeight = display.contentHeight</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>We want to make the main map as big as possible, but we need to
have room for controls on the left side, so we&#39;ll portion out one
sixth (1 / 6) of the screen width for the controller.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> controllerWidth = screenWidth / <span class="number">6</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We also want to leave a bit of room on the right side so the map doesn&#39;t
touch the edge of the screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> rightMargin = <span class="number">30</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2>Set up the maze map</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>We‘ll describe our maze using list-style Lua tables. This will let us
convey a lot of information with less typing. Our maze will be made of
a grid of pathways and walls. We can choose to use any two different values
to specify which grid squares have walls, and which have paths. I’m going
to use <code>0</code> for paths and <code>1</code> for walls but you could just as easily use
<code>&quot;w&quot;</code> for walls and <code>&quot;p&quot;</code> for paths. I use 0 and 1 because it&#39;s less to
type. Each row of the the maze grid is one list and the entire maze is just
a list of lists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> maze = {
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span> },
	{ <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> },
}
maze.rows = <span class="built_in">table</span>.getn(maze)
maze.columns = <span class="built_in">table</span>.getn(maze[<span class="number">1</span>])
maze.xStart, maze.yStart = <span class="number">1</span>, <span class="number">1</span>
maze.xFinish, maze.yFinish = <span class="number">24</span>, <span class="number">7</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h6">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h6>Alternative Maze storage possibilities</h6>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>Build the map grid.</h3>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Games need a field of play. One type of field is a two-dimensional grid.
It&#39;s like taking graph paper and laying it over a section of your screen
then you allow your game pieces to move between the grid squares based
on the rules of the game. Chess and Checkers are board games that work
this way. The Legend of Zelda (on old Nintendo) is a video game that
works this way and there are lots of others. Can you think of a few?</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>We want to make a grid. To do this in Lua we‘ll use an object. Let’s
start with an empty one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> grid = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Grids can be described by the number of squares across as well as the
number of squares up and down. We call the squares from left to right
&quot;the <em>x</em> direction and squares up and down the <em>y</em> direction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.xSquares = maze.columns
grid.ySquares = maze.rows</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>The total width of our grid is going to be the width of the screen
without the space taken up by the controller and without the space we
decided to leave for our margin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.totalWidth = screenWidth - controllerWidth - rightMargin</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Since we already decided how big our whole grid will be and how many
squares it will have, we can figure out how big our squares are using
basic algebra. The size of each square is equal to the width of the whole
map divided by the width of each square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.squareSize = grid.totalWidth / grid.xSquares</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>We&#39;re going to start our map at the edge of our controller. The last
pixel of our controller area is going to be the first pixel of our map
grid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.xStart = controllerWidth</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Just like we wanted to leave a bit of room along the right edge, we want
to leave some room on top of the screen. I found this to be a good
size but you can change it if you want.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.yStart = <span class="number">60</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Lastly, we want to create a group for all the grid tiles and objects on
our map so we can move them around all at once. This is going to help us
with positioning elements on screen later on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.displayGroup = display.newGroup()</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>The map is going to be shown on screen with its (0, 0) being the
(xStart, yStart) of the total screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.displayGroup.x = grid.xStart
grid.displayGroup.y = grid.yStart</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h3>Grid functions</h3>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>These functions will be placed on our grid squares. They&#39;ll help us find
adjacent squares when we need them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grid.functions = {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>This function looks for the square to the left of the current one. If
this square&#39;s <em>x</em> coordinate is 0, that means it must be the leftmost
square in that row, so we just say that the square to the left of this
one is the same as this one. Otherwise, we find the square in this same
row whose <em>x</em> coordinate is one less than our current square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	left = function(gridSquare)
		<span class="keyword">if</span> gridSquare.x == <span class="number">0</span> <span class="keyword">then</span>
			<span class="keyword">return</span> gridSquare
		<span class="keyword">else</span>
			<span class="keyword">return</span> grid[gridSquare.y][gridSquare.x - <span class="number">1</span>]
		<span class="keyword">end</span>
	<span class="keyword">end</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>When trying to find the square to the right, we need to watch out for
the rightmost square. Since we started counting squares at 0, the
rightmost square&#39;s <em>x</em> coordinate will be one less than the number of
grid squares in the <em>x</em> direction. So if the next square would be equal
to that number, we&#39;re at the end, and we give back the same square we
got, just like before otherwise, we return the square whose <em>x</em>
coordinate is one more than our current square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	right = function(gridSquare)
		<span class="keyword">if</span> gridSquare.x + <span class="number">1</span> == grid.xSquares <span class="keyword">then</span>
			<span class="keyword">return</span> gridSquare
		<span class="keyword">else</span>
			<span class="keyword">return</span> grid[gridSquare.y][gridSquare.x + <span class="number">1</span>]
		<span class="keyword">end</span>
	<span class="keyword">end</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If we‘re looking for the square above our current one. If we’re in
the top row, that means we give back this square, otherwise we take
the square whose <em>y</em> coordinate is one less than the current square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	above = function(gridSquare)
		<span class="keyword">if</span> gridSquare.y == <span class="number">0</span> <span class="keyword">then</span>
			<span class="keyword">return</span> gridSquare
		<span class="keyword">else</span>
			<span class="keyword">return</span> grid[gridSquare.y - <span class="number">1</span>][gridSquare.x]
		<span class="keyword">end</span>
	<span class="keyword">end</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Just one more! To find the square below, we add one to the <em>y</em>
coordinate. Unless of course we&#39;re in the last row, in which case we
return the given square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	below = function(gridSquare)
		<span class="keyword">if</span> gridSquare.y + <span class="number">1</span> == grid.ySquares <span class="keyword">then</span>
			<span class="keyword">return</span> gridSquare
		<span class="keyword">else</span>
			<span class="keyword">return</span> grid[gridSquare.y + <span class="number">1</span>][gridSquare.x]
		<span class="keyword">end</span>
	<span class="keyword">end</span>,
}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2>Setting up the map grid.</h2>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>In order to set up a grid, we&#39;ll loops to avoid repeating out similar code
for each of the grid squares. Because we have <em>x</em> coordinates and <em>y</em>
coordinates we&#39;ll use nested loops. One within another. This means that
each time we change the <em>y</em> coordinate we&#39;ll go through a whole column of
<em>x</em> values, then start a new row.</p>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>We&#39;ll start with rows this time around. Previously we started with <em>x</em>
values in the outer loop but because it‘s easier to write lists in rows
than in columns, we’ve switched it here so it will line up with our maze
better.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">for</span> y = <span class="number">0</span>, grid.ySquares - <span class="number">1</span> <span class="keyword">do</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>The first thing we do is create a row for this coordinate. We use <code>[]</code>
to “index” the column with its coordinate and set the x field for this
column to be the <em>x</em> coordinate value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	grid[y] = {y = y}</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Now we go column by column and set up the grid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">for</span> x = <span class="number">0</span>, grid.xSquares - <span class="number">1</span> <span class="keyword">do</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>For each grid square, we&#39;ll set it up to be indexed first by
its <em>x</em> coordinate and next by its <em>y</em> coordinate. We also
set the x and y fields of the square to match its coordinates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		grid[y][x] = {x = x, y = y}</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Now we create a display object for the rectangle. This is what
will allow us to actually draw the object on the screen.
The rectangle is part of the grid&#39;s display group. Just like we
are creating our own grid system, your computer has a grid system
made up of individual pixels and the <em>x</em> and <em>y</em> coordinates of
the display object aren&#39;t our <em>x</em> and <em>y</em> but we&#39;ll use our
coordinates to compute the pixel coordinates.</p>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>The pixel coordinate of a square will be our coordinate times the
size in pixels of a single square, then the width and height will
be that size alone.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">local</span> rect = display.newRect(grid.displayGroup,
		grid.squareSize * x, grid.squareSize * y,
		grid.squareSize, grid.squareSize)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Here we&#39;ll add in the maze elements to our grid. Because the maze uses
a list that begins with 1, where we started at 0, we add 1 to the <em>x</em>
and <em>y</em> values to get the correct maze square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">if</span> maze[y + <span class="number">1</span>][x + <span class="number">1</span>] == <span class="number">0</span> <span class="keyword">then</span>
			rect:setFillColor(<span class="number">245</span>, <span class="number">215</span>, <span class="number">98</span>)
		<span class="keyword">else</span> 
			grid[y][x].wall = <span class="keyword">true</span>
			rect:setFillColor(<span class="number">32</span>, <span class="number">96</span>, <span class="number">32</span>, <span class="number">255</span>)
		<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Now that we&#39;ve created our display object, we attach it to our
grid square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		grid[y][x].displayObject = rect</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>And finally we attach the functions we wrote earlier to each
square so it is more convient to call on them later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		grid[y][x].left = grid.functions.left
		grid[y][x].right = grid.functions.right
		grid[y][x].above = grid.functions.above
		grid[y][x].below = grid.functions.below</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>The end of one row.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>The end of one column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">end</span>

grid[maze.yStart - <span class="number">1</span>][maze.xStart - <span class="number">1</span>].start = <span class="keyword">true</span>
grid[maze.yStart - <span class="number">1</span>][maze.xStart - <span class="number">1</span>].displayObject:setFillColor(<span class="number">192</span>, <span class="number">192</span>, <span class="number">255</span>)
grid[maze.yFinish - <span class="number">1</span>][maze.xFinish - <span class="number">1</span>].displayObject:setFillColor(<span class="number">192</span>, <span class="number">128</span>, <span class="number">128</span>)
grid[maze.yStart - <span class="number">1</span>][maze.xStart - <span class="number">1</span>].start = <span class="keyword">true</span>
grid[maze.yFinish - <span class="number">1</span>][maze.xFinish - <span class="number">1</span>].finish = <span class="keyword">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2>Create the runner</h2>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Now we&#39;ll create a runner.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> runner = { image = <span class="string">"runner.png"</span> }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>We need a function to allow the runner to move to a particular square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">runner:enter</span><span class="params">(gridSquare)</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>The first time we show the character, there won‘t be a display object,
so we’ll have to create one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">if</span> self.displayObject == <span class="keyword">nil</span> <span class="keyword">then</span>
		self.displayObject = display.newImageRect(grid.displayGroup,
		self.image, grid.squareSize, grid.squareSize)
		self.displayObject:setFillColor(<span class="number">92</span>, <span class="number">92</span>, <span class="number">92</span>)
	<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Now our self&#39;s display object should be in the same position on
the screen as the grid square that self is in.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	self.displayObject.x = gridSquare.displayObject.x
	self.displayObject.y = gridSquare.displayObject.y</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>We&#39;ll keep track of the grid square each self is in. It will come
in handy when they want to move.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	self.gridSquare = gridSquare</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>we&#39;ll also save the <em>x</em> and <em>y</em> coordinate of the self just like
the grid square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	self.x = gridSquare.x
	self.y = gridSquare.y

	<span class="keyword">if</span> self.gridSquare.finish <span class="keyword">then</span>
		finish()
	<span class="keyword">end</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>The runner can only enter squares that don‘t have obstacles. Even though
all this method does is check for the presence of an obstacle, we’ll do
it like this because it controls the actions of the runner.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">runner:canEnter</span><span class="params">(gridSquare)</span></span>
	<span class="keyword">return</span> gridSquare.wall == <span class="keyword">nil</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h2>Creating the controls.</h2>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Our controls will be composed of an on-screen directional pad, just like
the one on a video game controller. Pressing the up, down, left, and
right buttons will move the runner around the map grid </p>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>The center of our control pad will be at the halfway point of the control
area width…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> controlCenterX = controllerWidth / <span class="number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>and one fifth of the way from the bottom of the screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> controlCenterY = screenHeight - screenHeight / <span class="number">5</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>The radius of the control pad will be just slightly smaller than half
the width of the controller area. This will leave a margin on the left
side, as well as some distance from the map grid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> controlCenterRadius = controllerWidth / <span class="number">2</span> - rightMargin</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>The size of our control buttons. The up and down</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> upDownWidth = <span class="number">27</span>
<span class="keyword">local</span> upDownHeight = <span class="number">60</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>The size of the left and right control buttons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> leftRightWidth = <span class="number">60</span>
<span class="keyword">local</span> leftRightHeight = <span class="number">27</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Container tables for the controls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> controls = {
	up    = {},
	down  = {},
	right = {},
	left  = {},
}</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Create a display group for the control pad.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>controls.displayGroup = display.newGroup()</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Now create a circle to house our directional pad.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> circlePad = display.newCircle(controls.displayGroup,
	controlCenterX, controlCenterY, controlCenterRadius)</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Let&#39;s make it stand out from the background.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>circlePad:setFillColor(<span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Here we create the display objects for the controls and place them on the
screen inside our control circle. Because there&#39;s a <em>lot</em> of typing in the
control name. (Think about typing <code>controls.up.displayObject</code> over and over)
We give each one a short, local name, then assign it to the field where it
belongs at the end. This is a very common strategy for creation blocks, but
whenver you do it, it makes the code just a little bit more confusing. So you
have to decide what is more important, saving yourself some typing or being
clearer so that the reader of the code knows what is going on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> up = display.newImageRect(controls.displayGroup, <span class="string">"arrow_up.png"</span>,
	upDownWidth, upDownHeight)
up.x = controlCenterX
up.y = controlCenterY - upDownHeight / <span class="number">2</span>
controls.up.displayObject = up

<span class="keyword">local</span> down = display.newImageRect(controls.displayGroup, <span class="string">"arrow_down.png"</span>,
  upDownWidth, upDownHeight)
down.x = controlCenterX
down.y = controlCenterY + upDownHeight / <span class="number">2</span>
controls.down.displayObject = down

<span class="keyword">local</span> right = display.newImageRect(controls.displayGroup, <span class="string">"arrow_right.png"</span>,
	leftRightWidth, leftRightHeight)
right.x = controlCenterX + leftRightWidth / <span class="number">2</span>
right.y = controlCenterY
controls.right.displayObject = right

<span class="keyword">local</span> left = display.newImageRect(controls.displayGroup, <span class="string">"arrow_left.png"</span>,
	leftRightWidth, leftRightHeight)
left.x = controlCenterX - leftRightWidth / <span class="number">2</span>
left.y = controlCenterY
controls.left.displayObject = left</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>We‘ll create a function to hide the controls so that at the end of the game
the player can’t take the runner <em>out</em> of the finish area.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>controls.hide = function(controls)
	controls.displayGroup.isVisible = <span class="keyword">false</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>We also need to create a show function so we can get the controls back at the
start of the game.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>controls.show = function(controls)
	controls.displayGroup.isVisible = <span class="keyword">true</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <h3>Make the runner move</h3>

            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>It‘s time to create functions that will move our runner into new grid
squares. We’ll define functions for moving left, right, up, and down.
The function will check that the grid square is free or has a wall before
moving into it. If the square is free, the runner will move there.
Otherwise the runner will stay where he is.</p>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>This function will run when we press the left arrow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressLeft</span><span class="params">(event)</span></span>
	<span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
		<span class="keyword">local</span> nextSquare = runner.gridSquare:left()
		<span class="keyword">if</span> runner:canEnter(nextSquare) <span class="keyword">then</span>
			runner:enter(nextSquare)
		<span class="keyword">end</span>
	<span class="keyword">end</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>This function will run when we press the right arrow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressRight</span><span class="params">(event)</span></span>
	<span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
		<span class="keyword">local</span> nextSquare  = runner.gridSquare:right()
		<span class="keyword">if</span> runner:canEnter(nextSquare) <span class="keyword">then</span>
			runner:enter(nextSquare)
		<span class="keyword">end</span>
	<span class="keyword">end</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>This function will run when we press the up arrow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressUp</span><span class="params">(event)</span></span>
	<span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
		<span class="keyword">local</span> nextSquare  = runner.gridSquare:above()
		<span class="keyword">if</span> runner:canEnter(nextSquare) <span class="keyword">then</span>
			runner:enter(nextSquare)
		<span class="keyword">end</span>
	<span class="keyword">end</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>This function will run when we press the down arrow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressDown</span><span class="params">(event)</span></span>
	<span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
		<span class="keyword">local</span> nextSquare  = runner.gridSquare:below()
		<span class="keyword">if</span> runner:canEnter(nextSquare) <span class="keyword">then</span>
			runner:enter(nextSquare)
		<span class="keyword">end</span>
	<span class="keyword">end</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Now we register each function as an event listener for the touch
event on the display object associated with each arrow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>controls.left.displayObject:addEventListener(<span class="string">"touch"</span>, pressLeft)
controls.right.displayObject:addEventListener(<span class="string">"touch"</span>, pressRight)
controls.up.displayObject:addEventListener(<span class="string">"touch"</span>, pressUp)
controls.down.displayObject:addEventListener(<span class="string">"touch"</span>, pressDown)</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Create the Start button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="keyword">local</span> startButton = {}
startButton.displayGroup = display.newGroup()
startButton.displayObject = display.newCircle(startButton.displayGroup,
	controlCenterX, controlCenterY, controlCenterRadius)</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>We&#39;ll give the button some color and accent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>startButton.displayObject.strokeWidth = <span class="number">6</span>
startButton.displayObject:setStrokeColor(<span class="number">244</span>, <span class="number">244</span>, <span class="number">64</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Write what the button does.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>startButton.text = display.newText(startButton.displayGroup, 
	<span class="string">"Start"</span>, controlCenterX - controlCenterRadius + <span class="number">20</span>, controlCenterY - <span class="number">18</span>,
	native.systemFont, <span class="number">24</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Make the text black</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>startButton.text:setTextColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>This function will run whenever you hit the start button. It will
hide the button from view and then start the game.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>startButton.touch = function(event)
	<span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
		startButton:hide()
		start()
	<span class="keyword">end</span>
<span class="keyword">end</span>
startButton.displayGroup:addEventListener(<span class="string">"touch"</span>, startButton.touch)</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>We need functions to show and hide the start button the game begins. We&#39;ll
write them as methods instead of explicitly naming the start button so
we can reuse them with the play again button.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>startButton.show = function(button)
	button.displayGroup.isVisible = <span class="keyword">true</span>
<span class="keyword">end</span>

startButton.hide = function(button)
	button.displayGroup.isVisible = <span class="keyword">false</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <h1>Create the Play Again button</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="keyword">local</span> playAgainButton = {}

playAgainButton.displayGroup = display.newGroup()

playAgainButton.displayObject = display.newCircle(playAgainButton.displayGroup,
	controlCenterX, controlCenterY, controlCenterRadius)</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>We&#39;ll give the button some color and accent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>playAgainButton.displayObject.strokeWidth = <span class="number">6</span>
playAgainButton.displayObject:setStrokeColor(<span class="number">244</span>, <span class="number">244</span>, <span class="number">64</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Write what the button does.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>playAgainButton.text = display.newText(playAgainButton.displayGroup, 
	<span class="string">"Again"</span>, controlCenterX - controlCenterRadius + <span class="number">20</span>, controlCenterY - <span class="number">18</span>,
	native.systemFont, <span class="number">24</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Make the text black</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>playAgainButton.text:setTextColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>This function will run whenever you hit the play again button. It will
hide the button from view and then start the game over.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>playAgainButton.touch = function(event)
	<span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
		playAgainButton:hide()
		play()
	<span class="keyword">end</span>
<span class="keyword">end</span>
playAgainButton.displayGroup:addEventListener(<span class="string">"touch"</span>, playAgainButton.touch)</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Since we wrote the <code>startButton:show</code> and <code>startButton:hide</code> functions in the
method style, we can recycle it on our play again button.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>playAgainButton.show = startButton.show
playAgainButton.hide = startButton.hide</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <h2>Create the stopwatch</h2>

            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>We‘ve decided that one way to make this game more fun is to time the user
while they run the maze. To do this, we’ll add a stopwatch to the game that
tracks the number of seconds from when when the player hits the start button
until the runner enters the finish square of the maze.</p>

            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Create the stopwatch object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">local</span> stopwatch = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>The clock starts at 0.0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>stopwatch.clock = <span class="number">0.0</span>

stopwatch.formatClock = function(watch)
	<span class="keyword">return</span> <span class="built_in">string</span>.format(<span class="string">"%3.1f"</span>, watch.clock)
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Create some text that will display the time on the watch.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>stopwatch.displayText = display.newText(stopwatch:formatClock(), <span class="number">100</span>, <span class="number">700</span>,
	native.systemFont, <span class="number">48</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>This function runs each “tick” of the stopwatch. It will update the displayed
time. Note that this function is <em>not</em> a method. We have to name the
stopwatch exactly instead of using the method style with a <code>watch</code> as a first
argument. There are ways around this, but they overcomplicate things. Maybe
we&#39;ll explore them in the future.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>stopwatch.increment = function(timerData)
	stopwatch.clock = stopwatch.clock + <span class="number">0.1</span>
	stopwatch.displayText.text = stopwatch:formatClock()
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Write a method that starts the stopwatch.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>stopwatch.start = function(watch)</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>We use the perform with delay library function to have Corona call us
when the timer runs out. We&#39;ve set the timer to run ever 1000 milliseconds.
A millisecond is 1/1000th of a second so if we wait 1000 1/1000ths of a
second we wait exactly one second. Say that 10 times fast. We tell Corona
to “call us” by running our watch increment function. The last 0 is the
argument that tells Corona how many times to re-run the timer. By sending a
zero we tell Corona to run forever.</p>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Since this function is going to call us when the time runs out. So what
does it return <em>right now</em>? It returns a timer ID number that we can use
to stop the timer later. We need to save this so we can stop the timer when
the player&#39;s runner crosses the finish line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	watch.timer = timer.performWithDelay(<span class="number">100</span>, watch.increment, <span class="number">0</span>)
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Now we need to stop the stopwatch when the runner finishes the maze. We can
do that by cancelling the timer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>stopwatch.stop = function(watch)
	timer.cancel(watch.timer)
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>All we have left to do is make sure we can reset the watch. to do so. We just
set the clock back to zero and update the display.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>stopwatch.reset = function(watch)
	watch.clock = <span class="number">0</span>
	watch.displayText.text = watch:formatClock()
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <h2>The main game function</h2>

            </div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>This play function is much simpler than our last game because we took most
of the code out so it only ran once. This means that our game will start
over many more times without crashing, but it also means less can change
between restarts. The extra section will show you how to change the maze
between restarts. When the player finishes, they can still start over
without closing and restarting the game.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>The runner starts off in the maze start.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	runner:enter(grid[maze.yStart - <span class="number">1</span>][maze.xStart - <span class="number">1</span>])</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>The play again button starts out hidden since we haven&#39;t started yet!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	playAgainButton:hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>The controls start out hidden because we want the player to call “start”
first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	controls:hide()
	stopwatch:reset()
	startButton:show()
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <h2>Start the game</h2>

            </div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>The start function hides teh start button and shows the controls. This
allows the player to start moving the runner.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span>
	controls:show()
	stopwatch:start()
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <h2>Finish!</h2>

            </div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Finish the game by hiding the controls and displaying the play again button.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">finish</span><span class="params">()</span></span>
	controls:hide()
	stopwatch:stop()
	playAgainButton:show()
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Play the game!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>play()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
